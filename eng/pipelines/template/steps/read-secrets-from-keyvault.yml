parameters:
- name: SecretName
  type: string
  default: ""
- name: OutputValueName  
  type: string
  default: ""
- name: ServiceConnection
  type: string
  default: "azure-sdk-github-secrets"
- name: KeyVaultName
  type: string
  default: "azure-sdk-github-secrets"

steps:
  - ${{ if or(eq(parameters.ServiceConnection, ''), eq(parameters.KeyVaultName, ''), eq(parameters.SecretName, '')) }}:
      - error: "ServiceConnection, KeyVaultName and SecretName are required parameters to the read-secrets-from-keyvault.yml template."
  - ${{ else }}:
    - task: AzureCLI@2
      displayName: Read key from Key Vault
      inputs:
        azureSubscription: 'azure-sdk-github-secrets'
        scriptType: 'pscore'
        scriptLocation: 'inlineScript'
        inlineScript: |
          $secretValue = az keyvault secret show --name ${{ parameters.SecretName }} --vault-name ${{ parameters.KeyVaultName }} --query value --output tsv
          echo "##vso[task.setvariable variable=${{ coalesce(parameters.OutputValueName, parameters.SecretName) }};issecret=true;]$secretValue"